<!DOCTYPE html>

<html data-wf-page="6143c6fb05412b1bc933d7d3" data-wf-site="6143c6fb05412be0e033d7d2">
<head>
<meta charset="utf-8">
<title>LBAC Staking DayCare</title>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Webflow" name="generator">
 <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.css">
    <link href="css/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/loader.css">
    <link rel="stylesheet" href="css/style.css">
   <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Marvel:ital,wght@0,400;1,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/siiimple-toast/dist/style.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/siiimple-toast/dist/siiimple-toast.min.js"></script>
    <script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
        <script>const currentPage = "home";</script>

    <!-- Then jQuery -->
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6143c6fb05412be0e033d7d2" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    
    <!-- Remove the script from bottom of body and place it here -->
    <script src="js/webflow0.js" type="text/javascript"></script>

    <style>
        body, .headline, .segment-wrapper .description h3, .feature, .auctions-wrapper .description .auctions .auction .name, .auctions-wrapper .description .auctions .auction .winner, .btnBuy  {
        font-family: 'Marvel', sans-serif;
        }


	
	
	
	a.class_A1{ /* Стиль ссылки по умолчанию */
	color: white;
	font-weight: bold;
	text-decoration: none;
	}
	a.class_A1:hover{ /* Стиль ссылки при наведение */
	color: #ffe400;	/* Изменяем цвет на красный */
	text-decoration: none; /* Добавляем подчеркивание */

	}
	
	
	
		a.class_A2{ /* Стиль ссылки по умолчанию */
	color: white;
	text-decoration: none;
	}
	a.class_A2:hover{ /* Стиль ссылки при наведение */
	color: white;
	text-decoration: none;

	}
	
	
	
	

        .auction .feature { 
            margin-bottom: 10px;
        }
        
        .text { 
            line-height: 1.5rem;
            text-align: justify;
            font-family: 'Marvel', sans-serif;
        }
        
        .auctions-wrapper .description .auctions .auction .winner  {
            line-height: 1.5rem;   
                                font-family: 'Marvel', sans-serif;
        }
        
        .disclaimer {
            line-height: 1.5rem;
           margin-right: auto;
            margin-left: auto;
                                font-family: 'Marvel', sans-serif;

        }
        .disclaimermobile {
            line-height: 1.5rem;
            margin-right: auto;
            margin-left: auto;
        }
        
        .auctions-wrapper .description .auctions .auction .name {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .total {
            font-weight: 900 !important;
            color: #c9fff6;
            border-bottom: 1px solid #c9fff6;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .auctions-wrapper .description .auctions {
            justify-content: center;
        }
        
        .btnBuy {
            padding: 10px;
            font-size: 2rem;
            background-color: #69d47c;
            width: 300px;
            height: auto;
            margin: auto;
            
        }
        .segment-wrapper .punk-image {
            overflow: clip;
            width: auto;
            max-width: 400px;
            height: auto;
        }
        
        .segment-wrapper .punk-image img {
            width: auto;
            max-width: 400px;
            height: auto;
            border-radius: 30px;
        }
        
        .modal__title {
            color: #ff0000 !important;
            margin: auto;
            vertical-align: top
        }
        
        .button, .button__blue, .button__secondary, .button__wide, .button__wide__secondary {
            background-color: #69d47c;
        }
        
        .headline {
            font-size: 50px;
            margin: 50px;
        }
        
        
        .monstrocontainer {
    bottom: 0;
    left: 0;
    height: auto;
    margin: auto;
    position: absolute;
    right: 0;
    text-align: center;
    top: 0;
    width: 100%;
}

.monstrocontainer img {
    width: 100%;
    height: auto;
      border-radius: 30px;
      
}

    @import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css);
@import url('https://fonts.googleapis.com/css2?family=Marvel:wght@400;700&display=swap');

body2 {
	 font-family: 'Saira Condensed', sans-serif;
	background: #353535;
	color: #FFF;
}
.jumbotron h1 {
	color: #353535;
}
footer2 {
  margin-bottom: 0 !important;
  margin-top: 0;
}
footer p {
  margin: 0;
  padding: 0;
}
span.icon {
	margin: 0 5px;
	color: #D64541;
}
h2 {
	color: #BDC3C7;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.mrng-60-top {
	margin-top: 60px;
}
/* Global Button Styles */
a.animated-button:link, a.animated-button:visited {
	position: relative;
	display: block;
	margin: 5px auto 0;
	padding: 5px 5px;
	color: #fff;
	font-size:14px;
	font-weight: bold;
	text-align: center;
	text-decoration: none;
	text-transform: uppercase;
	overflow: hidden;
	letter-spacing: .08em;
	border-radius: 0;
	text-shadow: 0 0 1px rgba(0, 0, 0, 0.2), 0 1px 0 rgba(0, 0, 0, 0.2);
	-webkit-transition: all 1s ease;
	-moz-transition: all 1s ease;
	-o-transition: all 1s ease;
	transition: all 1s ease;
}
a.animated-button-mint:link, a.animated-button-mint:visited {
	position: relative;
	display: block;
	margin: 5px auto 0;
	padding: 5px 5px;
	color: #FFFD9C;
	font-size:14px;
	font-weight: bold;
	text-align: center;
	text-decoration: none;
	text-transform: uppercase;
	overflow: hidden;
	letter-spacing: .08em;
	border-radius: 0;
	text-shadow: 0 0 1px rgba(0, 0, 0, 0.2), 0 1px 0 rgba(0, 0, 0, 0.2);
	-webkit-transition: all 1s ease;
	-moz-transition: all 1s ease;
	-o-transition: all 1s ease;
	transition: all 1s ease;
}
a.animated-button-mint2:link, a.animated-button-mint2:visited {
	color: #FFFD9C;
	font-weight: bold;
}
a.animated-button:link:after, a.animated-button:visited:after {
	content: "";
	position: absolute;
	height: 0%;
	left: 50%;
	top: 50%;
	width: 150%;
	z-index: -1;
	-webkit-transition: all 0.75s ease 0s;
	-moz-transition: all 0.75s ease 0s;
	-o-transition: all 0.75s ease 0s;
	transition: all 0.75s ease 0s;
}
a.animated-button:link:hover, a.animated-button:visited:hover {
	color: #FFF;
	text-shadow: none;
}
a.animated-button:link:hover:after, a.animated-button:visited:hover:after {
	height: 450%;
}
a.animated-button:link, a.animated-button:visited {
	position: relative;
	display: block;
	margin: 5px auto 0;
	padding: 5px 5px;
	color: #fff;
	font-size:14px;
	border-radius: 0;
	font-weight: bold;
	text-align: center;
	text-decoration: none;
	text-transform: uppercase;
	overflow: hidden;
	letter-spacing: .08em;
	text-shadow: 0 0 1px rgba(0, 0, 0, 0.2), 0 1px 0 rgba(0, 0, 0, 0.2);
	-webkit-transition: all 1s ease;
	-moz-transition: all 1s ease;
	-o-transition: all 1s ease;
	transition: all 1s ease;
}


.centerimage {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}

.img_mobile {
    margin:auto;
    width: 100%; 
    max-width: 100%; 
    height: auto;
}
      
      .centerimage {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
      
      
   .div-6u{
width:50%;
clear:none;
margin-left:auto;
margin-right:auto;

}  

hr{
        height: 2px;
        background-color: #0f2335;
        border: none;
    }
      
p {
  text-align: center;
  font-size: 60px;
  margin-top: 0px;
}
       
       
       #countdown_cm {
      min-width: 250px;
    min-height: 20px;
 display: flex;
    justify-content: center
}
#countdown_cm .time {
	text-align: center;
    padding: 0 15px;
    display: flex;
    justify-content: center
}
#countdown_cm .time span {
	color: rgb(255,255,255);
    font-size: 38px;
    line-height: 1;
    border-radius: 3px;
    padding: 6px 5px 5px;
    letter-spacing: 0.7px;
     display: flex;
    justify-content: center
}
#countdown_cm .time label {
    font-weight: 700;
    color: white;
    margin: 10px 0px 0px;
    line-height: 1;
     display: flex;
    justify-content: center
}
      
      a.button2{
  display:inline-block;
	
	text-decoration:none;	
	
	color:rgba(253, 233, 58, 1);
	background-color:transparent;
	border:1px solid rgba(253, 233, 58, 1);
	border-radius:100px;
	
	padding: .3em 1.2em;
	margin:5px;
			
	background-size: 200% 100%;	
	background-image: linear-gradient(to right, transparent 50%, rgba(253, 233, 58, 1) 50%);
	transition: background-position .3s cubic-bezier(0.19, 1, 0.22, 1) .1s, color .5s ease 0s, background-color .5s ease;
}

a.button2:hover{
	color:rgba(22, 29, 39, 1);
	background-color:rgba(253, 233, 58, 1);
	background-position: -100% 100%;
}
 
        
    </style>
    
  
    <script>
function hoverland(element) {
  element.setAttribute('src', 'images/land.jpg');
}

function unhoverland(element) {
  element.setAttribute('src', 'images/landtest.jpg');
}
</script>
    <script>
function hoverair(element) {
  element.setAttribute('src', 'images/air.jpg');
}

function unhoverair(element) {
  element.setAttribute('src', 'images/airtest.jpg');
}
</script>
    <script>
function hoverfire(element) {
  element.setAttribute('src', 'images/fire.jpg');
}

function unhoverfire(element) {
  element.setAttribute('src', 'images/firetest.jpg');
}
</script>
    <script>
function hoverwater(element) {
  element.setAttribute('src', 'images/water.jpg');
}

function unhoverwater(element) {
  element.setAttribute('src', 'images/watertest.jpg');
}

async function anonymiceAbi(){
  let abi = await fetch('../abis/anonymice.json')
            .then(response => response.json())  // Convert response to JSON
            .catch(error => console.error("Error loading JSON:", error));
  return abi
}

async function checkMetaMask() {
  try {
    // Specifically check for MetaMask
    if (typeof window.ethereum === 'undefined' || !window.ethereum.isMetaMask) {
      alert('Please install MetaMask to use this feature');
      return false;
    }
    
    // Check if we're on the correct network (Ethereum Mainnet)
    const chainId = await window.ethereum.request({ 
      method: 'eth_chainId',
      from: 'metamask'
    });
    
    if (chainId !== '0x1') { // 0x1 is Ethereum Mainnet
      alert('Please connect to Ethereum Mainnet');
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x1' }],
          from: 'metamask'
        });
      } catch (switchError) {
        console.error('Failed to switch network:', switchError);
        return false;
      }
    }
    return true;
  } catch (error) {
    console.error('MetaMask check failed:', error);
    return false;
  }
}

async function ensureMetaMaskConnected() {
  try {
    const accounts = await window.ethereum.request({ 
      method: "eth_requestAccounts",
      params: []
    });

    if (!accounts || accounts.length === 0) {
      throw new Error("No accounts found. Please connect MetaMask.");
    }

    return accounts[0];
  } catch (error) {
    console.error("MetaMask connection error:", error);
    if (error.code === 4001) {
      // User rejected the connection
      alert("Please connect your MetaMask wallet to continue.");
    } else {
      alert("Error connecting to MetaMask: " + error.message);
    }
    throw error;
  }
}

const getAddress = async () => {
  if (!await checkMetaMask()) {
    throw new Error('MetaMask is required');
  }
  return await ensureMetaMaskConnected();
};

const anonymiceAddress = "0x918F677b3aB4B9290Ca96A95430FD228b2d84817";


async function initializeAnonymiceContract(){
  const web3 = await initializeWeb3();
  const abi = await anonymiceAbi();
  return new web3.eth.Contract(abi, anonymiceAddress);
}

const cheethAddress = "0x0DdF1dAc8537C90b0a96Bdf05A8c9eD78ccD26cA";
async function approveMicesToCheeth() {
  try {
    if (!await checkMetaMask()) {
      return;
    }
    
    const anonymice = await initializeAnonymiceContract();
    
    if (await anonymice.methods.isApprovedForAll(await getAddress(), cheethAddress)) {
      window.alert(`Baby has already been approved!`);
      return;
    }
    const address = await getAddress();
    await anonymice.methods.setApprovalForAll(cheethAddress, true).send({from: address});
    
  } catch (error) {
    console.error("Approval failed:", error);
    alert("Approval failed: " + error.message);
  }
}

async function cheethAbi(){
 
 let abi = await fetch('../abis/cheeth.json')
            .then(response => response.json())  // Convert response to JSON
            .catch(error => console.error("Error loading JSON:", error));
  return abi
};

let connected = false;


  async function intializeCheethContract(){
    const web3 = await initializeWeb3();
    let abi = await cheethAbi();
    return new web3.eth.Contract(abi, cheethAddress);
  }


const stakeMicesToCheeth = async () => {
  try {
    if (!await checkMetaMask()) {
      return;
    }
    
    const _micesInput = $("#micesId").val().trim();
    
    // Input validation
    if (!_micesInput) {
      alert("Please enter Baby IDs");
      return;
    }

    // Split by comma and filter out empty strings
    const _micesArray = _micesInput.split(",")
      .map(id => id.trim())
      .filter(id => id.length > 0)
      .map(id => {
        const num = parseInt(id, 10);
        if (isNaN(num)) {
          throw new Error(`Invalid ID: ${id}`);
        }
        return num;
      });

    if (_micesArray.length === 0) {
      alert("Please enter valid Baby IDs");
      return;
    }

    const cheeth = await intializeCheethContract();
    const anonymice = await initializeAnonymiceContract();
    const address = await getAddress();
    
    // Check user's ETH balance
    const web3 = await initializeWeb3();
    const balance = await web3.eth.getBalance(address);
    
    // Estimate gas for the transaction
    try {
      const gasEstimate = await cheeth.methods.stakeByIds(_micesArray).estimateGas({ from: address });
      const gasPrice = await web3.eth.getGasPrice();
      const gasCost = web3.utils.toBN(gasEstimate).mul(web3.utils.toBN(gasPrice));
      
      if (web3.utils.toBN(balance).lt(gasCost)) {
        alert("Insufficient funds for gas. Please make sure you have enough ETH to cover gas fees.");
        return;
      }
    } catch (gasError) {
      console.error("Gas estimation failed:", gasError);
      alert("Transaction might fail. Please make sure you have enough ETH for gas fees.");
    }

    const _stakedAnonymices = await cheeth.methods.getTokensStaked(address).call();

    if (!(await anonymice.methods.isApprovedForAll(address, cheethAddress).call())) {
      alert("You need to approve your Baby first!");
      return;
    }

    if (_stakedAnonymices.length >= 10) {
      alert("Maximum of 10 Staked per address reached already!");
      return;
    }

    // Add loading indicator or message
    const stakeButton = document.querySelector('[onclick="stakeMicesToCheeth()"]');
    const originalText = stakeButton.textContent;
    stakeButton.textContent = "Staking...";
    stakeButton.style.opacity = "0.5";

    await cheeth.methods.stakeByIds(_micesArray).send({ 
      from: address,
      maxPriorityFeePerGas: null,
      maxFeePerGas: null 
    });
    
    window.location.reload();
  } catch (error) {
    console.error("Transaction failed:", error);
    
    // Reset button state if there was an error
    const stakeButton = document.querySelector('[onclick="stakeMicesToCheeth()"]');
    stakeButton.textContent = "Stake Baby";
    stakeButton.style.opacity = "1";

    if (error.message.includes("insufficient funds")) {
      alert("Insufficient funds. Please make sure you have enough ETH to cover the transaction and gas fees.");
    } else if (error.message.includes("Invalid ID")) {
      alert(error.message);
    } else if (error.message.includes("MetaMask")) {
      alert(error.message);
    } else {
      alert("Transaction failed: " + error.message);
    }
  }
};


</script>



    <script>
function needelman(element) {
  element.setAttribute('src', 'images/land.jpg');
}

function unneedelman(element) {
  element.setAttribute('src', 'images/needelman.png');
}
</script>
</head>
<body>
 <div class="background-wrapper container">
        <div class="container">
                     

  <div class="row">
    <div class="col-md-12 text-center">
        <br>
<h1 class="heading">LBAC Staking DayCare</h1>
<br>
   </div>
  </div>
    <h4><div class="row" align="center">

</div></h4>

<div class="col-md-12 text-center">
    <hr>
    
<br>
<br>
<div class="col-md-12 text-center">

<h3><a href="index.html#" id="approveButton" class="button2" onclick=approveMicesToCheeth()>Approve Baby</a></h3><br>
</div>
<div class="col-md-12 text-center">
<h5><div class="col-md-12 text-center" id="your-baby-ids"><a target="blank" href="https://opensea.io/account?search[query]=lil baby ape club">Your Lil Baby Ape IDs</a></div></h5>
<div class="col-md-12 text-center">(for multiple, seperate by a comma. Exapmle: 21,40)</div>
<div class="modal__buy__form"><h4><input type="text" id="micesId" name="micesId" placeholder="Input Lil Baby Ape IDs" value=""> </h4></div>
<h3><a class="button2" onclick="stakeMicesToCheeth()">Stake Baby</a></h3>
</div>
<br>
<br>
<hr>
<br><br>

<div class="col-md-12 text-center">
    

<h3><a href="../" class="button2">Back</a></h3>
</div>
<br>
<br>

<br>
<br>
<br>
</div>
</div>
</div>
<script>
// Update the initialization of Web3
async function initializeWeb3() {
  // Specifically check for MetaMask
  if (typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask) {
    try {
      // Request account access if needed
      await window.ethereum.request({ 
        method: 'eth_requestAccounts',
        // Add this to ensure MetaMask handles the request
        params: [],
        from: 'metamask'
      });
      
      // Explicitly create Web3 instance with MetaMask provider
      const provider = window.ethereum;
      return new Web3(provider);
    } catch (error) {
      console.error('MetaMask access denied:', error);
      throw new Error('Please allow MetaMask access to continue');
    }
  } else {
    alert('Please install MetaMask to use this feature');
    throw new Error('MetaMask not detected');
  }
}

// Update checkMetaMask function
async function checkMetaMask() {
  try {
    // Specifically check for MetaMask
    if (typeof window.ethereum === 'undefined' || !window.ethereum.isMetaMask) {
      alert('Please install MetaMask to use this feature');
      return false;
    }
    
    // Check if we're on the correct network (Ethereum Mainnet)
    const chainId = await window.ethereum.request({ 
      method: 'eth_chainId',
      from: 'metamask'
    });
    
    if (chainId !== '0x1') { // 0x1 is Ethereum Mainnet
      alert('Please connect to Ethereum Mainnet');
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x1' }],
          from: 'metamask'
        });
      } catch (switchError) {
        console.error('Failed to switch network:', switchError);
        return false;
      }
    }
    return true;
  } catch (error) {
    console.error('MetaMask check failed:', error);
    return false;
  }
}

// Update the event listeners
if (window.ethereum && window.ethereum.isMetaMask) {
  window.ethereum.on('chainChanged', (chainId) => {
    window.location.reload();
  });

  window.ethereum.on('accountsChanged', (accounts) => {
    window.location.reload();
  });
}
</script>
</body>
</html>